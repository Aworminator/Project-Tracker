<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css?v=1.0" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Navigation Header -->
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-brand">
          <i class="fas fa-project-diagram"></i>
          <span>Project Tracker</span>
        </div>

        <div class="nav-user">
          <div class="user-info">
            <span class="user-name" id="userName">Loading...</span>
            <span class="user-role" id="userRole">Loading...</span>
          </div>
          <a href="/logout" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            Logout
          </a>
        </div>
      </div>
    </nav>

    <!-- Main Dashboard Container -->
    <div class="dashboard-container">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-menu">
          <button class="menu-item active" onclick="showSection('projects')">
            <i class="fas fa-folder"></i>
            Projects
          </button>
          <button
            class="menu-item"
            onclick="showSection('tasks')"
            id="tasksMenuItem"
          >
            <i class="fas fa-tasks"></i>
            Tasks
          </button>
          <button
            class="menu-item admin-only"
            onclick="showSection('users')"
            id="usersMenuItem"
          >
            <i class="fas fa-users"></i>
            Users
          </button>
          <button
            class="menu-item"
            onclick="showSection('reports')"
            id="reportsMenuItem"
          >
            <i class="fas fa-chart-bar"></i>
            Reports
          </button>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Projects Section -->
        <section id="projectsSection" class="content-section active">
          <div class="section-header">
            <h2><i class="fas fa-folder"></i> Projects</h2>
            <button
              class="btn btn-primary admin-manager-only"
              onclick="showCreateProjectModal()"
            >
              <i class="fas fa-plus"></i>
              New Project
            </button>
          </div>

          <div class="projects-grid" id="projectsGrid">
            <!-- Projects will be dynamically loaded here -->
          </div>
        </section>

        <!-- Tasks Section -->
        <section id="tasksSection" class="content-section">
          <div class="section-header">
            <h2><i class="fas fa-tasks"></i> Tasks</h2>
            <div class="task-filters">
              <select id="projectFilter" onchange="filterTasks()">
                <option value="">All Projects</option>
              </select>
              <select id="statusFilter" onchange="filterTasks()">
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="in-progress">In Progress</option>
                <option value="completed">Completed</option>
              </select>
              <button
                class="btn btn-primary"
                onclick="showCreateTaskModal()"
                style="margin-left: 0.5rem"
              >
                <i class="fas fa-plus"></i>
                New Task
              </button>
            </div>
          </div>

          <div class="tasks-container">
            <div class="task-column">
              <h3>Pending</h3>
              <div class="task-list" id="pendingTasks"></div>
            </div>
            <div class="task-column">
              <h3>In Progress</h3>
              <div class="task-list" id="inProgressTasks"></div>
            </div>
            <div class="task-column">
              <h3>Completed</h3>
              <div class="task-list" id="completedTasks"></div>
            </div>
          </div>
        </section>

        <!-- Users Section (Admin Only) -->
        <section id="usersSection" class="content-section">
          <div class="section-header">
            <h2><i class="fas fa-users"></i> User Management</h2>
            <button class="btn btn-primary" onclick="showInviteUserModal()">
              <i class="fas fa-user-plus"></i>
              Invite User
            </button>
          </div>

          <div class="users-table-container">
            <table class="users-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <!-- Users will be dynamically loaded here -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- Reports Section -->
        <section id="reportsSection" class="content-section">
          <div class="section-header">
            <h2><i class="fas fa-chart-bar"></i> Reports</h2>
          </div>

          <div class="reports-grid">
            <div class="report-card">
              <h3>Project Progress</h3>
              <div class="progress-stats">
                <div class="stat">
                  <span class="stat-number" id="totalProjects">0</span>
                  <span class="stat-label">Total Projects</span>
                </div>
                <div class="stat">
                  <span class="stat-number" id="activeProjects">0</span>
                  <span class="stat-label">Active Projects</span>
                </div>
                <div class="stat">
                  <span class="stat-number" id="completedProjects">0</span>
                  <span class="stat-label">Completed</span>
                </div>
              </div>
            </div>

            <div class="report-card">
              <h3>Task Overview</h3>
              <div class="progress-stats">
                <div class="stat">
                  <span class="stat-number" id="totalTasks">0</span>
                  <span class="stat-label">Total Tasks</span>
                </div>
                <div class="stat">
                  <span class="stat-number" id="myTasks">0</span>
                  <span class="stat-label">My Tasks</span>
                </div>
                <div class="stat">
                  <span class="stat-number" id="overdueTasks">0</span>
                  <span class="stat-label">Overdue</span>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Create Project Modal -->
    <div class="modal" id="createProjectModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Create New Project</h3>
          <button class="close-btn" onclick="closeModal('createProjectModal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="createProjectForm">
          <div class="input-group">
            <label for="projectName">Project Name</label>
            <input type="text" id="projectName" name="projectName" required />
          </div>
          <div class="input-group">
            <label for="projectDescription">Description</label>
            <textarea
              id="projectDescription"
              name="projectDescription"
              rows="3"
            ></textarea>
          </div>
          <div class="input-group">
            <label for="projectDeadline">Deadline</label>
            <input type="date" id="projectDeadline" name="projectDeadline" />
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('createProjectModal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              Create Project
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Create Task Modal -->
    <div class="modal" id="createTaskModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Create New Task</h3>
          <button class="close-btn" onclick="closeModal('createTaskModal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="createTaskForm">
          <div class="input-group">
            <label for="taskTitle">Task Title</label>
            <input type="text" id="taskTitle" name="taskTitle" required />
          </div>
          <div class="input-group">
            <label for="taskProject">Project</label>
            <select id="taskProject" name="taskProject" required>
              <option value="">Select Project</option>
            </select>
          </div>
          <div class="input-group">
            <label for="taskAssignee">Assign To</label>
            <select id="taskAssignee" name="taskAssignee">
              <option value="">Select Team Member</option>
            </select>
          </div>
          <div class="input-group">
            <label for="taskDescription">Description</label>
            <textarea
              id="taskDescription"
              name="taskDescription"
              rows="3"
            ></textarea>
          </div>
          <div class="input-group">
            <label for="taskPriority">Priority</label>
            <select id="taskPriority" name="taskPriority">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('createTaskModal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">Create Task</button>
          </div>
        </form>
      </div>
    </div>

    <!-- View Project Modal -->
    <div class="modal" id="viewProjectModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Project Details</h3>
          <button class="close-btn" onclick="closeModal('viewProjectModal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="project-details">
            <div class="detail-group">
              <label>Project Name:</label>
              <span id="viewProjectName">-</span>
            </div>
            <div class="detail-group">
              <label>Description:</label>
              <p id="viewProjectDescription">-</p>
            </div>
            <div class="detail-group">
              <label>Status:</label>
              <span id="viewProjectStatus" class="status-badge">-</span>
            </div>
            <div class="detail-group">
              <label>End Date:</label>
              <span id="viewProjectEndDate">-</span>
            </div>
            <div class="detail-group">
              <label>Team Members:</label>
              <div id="viewProjectTeam" class="team-list">-</div>
            </div>
            <div class="detail-group">
              <label>Progress:</label>
              <div class="progress-container">
                <div class="progress-bar">
                  <div id="viewProjectProgress" class="progress-fill"></div>
                </div>
                <span id="viewProjectProgressText">0%</span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeModal('viewProjectModal')"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Edit Project Modal -->
    <div class="modal" id="editProjectModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Project</h3>
          <button class="close-btn" onclick="closeModal('editProjectModal')">
            &times;
          </button>
        </div>
        <form id="editProjectForm" onsubmit="submitEditProject(event)">
          <div class="modal-body">
            <input type="hidden" id="editProjectId" />
            <div class="form-group">
              <label for="editProjectName">Project Name</label>
              <input
                type="text"
                id="editProjectNameInput"
                name="name"
                required
                maxlength="100"
              />
            </div>
            <div class="form-group">
              <label for="editProjectDescription">Description</label>
              <textarea
                id="editProjectDescriptionInput"
                name="description"
                rows="4"
                maxlength="500"
              ></textarea>
            </div>
            <div class="form-group">
              <label for="editProjectStatus">Status</label>
              <select id="editProjectStatusInput" name="status" required>
                <option value="planning">Planning</option>
                <option value="active">Active</option>
                <option value="on-hold">On Hold</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <div class="form-group">
              <label for="editProjectEndDate">End Date</label>
              <input type="date" id="editProjectEndDateInput" name="end_date" />
            </div>
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('editProjectModal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Message Container -->
    <div class="message-container" id="messageContainer">
      <div class="message" id="message"></div>
    </div>

    <script src="/js/auth.js"></script>
    <script src="/js/dashboard.js"></script>
    <script src="/js/app.js"></script>
  </body>
</html>
